
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/player.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'cc517a7X65GZZCoZXzsJRfj', 'player');
// Script/player.js

"use strict";

// Learn cc.Class:
//  - https://docs.cocos.com/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html
cc.Class({
  "extends": cc.Component,
  properties: {
    // 主角跳跃高度
    jumpHeight: 200,
    // 主角跳跃持续时间
    jumpDuration: 0.3,
    pace: 10,
    fruitLabel: cc.Label,
    jumpSound: cc.AudioClip,
    jumpSkill: 1,
    life: 3,
    lifeLabel: cc.Label
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    cc.director.getPhysicsManager().enabled = true;
    cc.director.getCollisionManager().enabled = true; //按压功能

    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, function (key) {
      if (key.keyCode == cc.macro.KEY.up) {
        if (this.jumpSkill > 0) {
          if (Global.dianjiSound) {
            cc.audioEngine.play(cc.find("Canvas/Main Camera/pause").getComponent("game_menu").sound, false, 1);
          }

          this.node.runAction(this.setJumpAction());
          this.jumpSkill = 0;
        }
      }

      ;

      if (key.keyCode == cc.macro.KEY.left) {
        this.value_left = 1;
      }

      ;

      if (key.keyCode == cc.macro.KEY.right) {
        this.value_right = 1;
      }

      ;
    }, this); //抬起功能

    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, function (key) {
      if (key.keyCode == cc.macro.KEY.left) {
        this.value_left = 0;
      }

      ;

      if (key.keyCode == cc.macro.KEY.right) {
        this.value_right = 0;
      }

      ;
    }, this);
  },
  onCollisionEnter: function onCollisionEnter(other, self) {
    if (other.node.group == "jellyfish") {
      other.node.destroy();
      this.life--;
      self.node.runAction(new cc.blink(0.5, 3)); //cc.find("Canvas/Main Camera").getComponent("game_1").timer = 0;

      this.lifeLabel.string = "X " + this.life;
    }

    ;

    if (other.node.group == "heart") {
      this.life++;
      this.lifeLabel.string = "X " + this.life;
      other.node.destroy();
    }

    ;

    if (other.node.group == "home") {
      this.jumpSkill = 1;
    }
  },
  start: function start() {},
  update: function update(dt) {
    if (this.value_left == 1) {
      this.node.runAction(this.leftMove());
      this.getComponent(cc.Animation).play("派大星左走");
    } else {
      this.getComponent(cc.Animation).stop("派大星左走");
    }

    if (this.value_right == 1) {
      this.node.runAction(this.rightMove());
      this.getComponent(cc.Animation).play("派大星右走");
    } else {
      this.getComponent(cc.Animation).stop("派大星右走");
    }
  },
  rightMove: function rightMove() {
    var rMove = cc.moveBy(0.02, cc.v2(this.pace, 0));
    return this.node.runAction(rMove);
  },
  leftMove: function leftMove() {
    var lMove = cc.moveBy(0.02, cc.v2(-this.pace, 0));
    return this.node.runAction(lMove);
  },
  setJumpAction: function setJumpAction() {
    // 跳跃上升
    var jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut()); // 下落
    // let jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn());
    // // 单次上升下落
    // return cc.sequence(jumpUp, jumpDown);

    return this.node.runAction(jumpUp);
  },
  onDestroy: function onDestroy() {
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, function (key) {
      if (key.keyCode == cc.macro.KEY.up) {
        if (this.jumpSkill > 0) {
          if (Global.dianjiSound) {
            cc.audioEngine.play(cc.find("Canvas/Main Camera/pause").getComponent("game_menu").sound, false, 1);
          }

          this.node.runAction(this.setJumpAction());
          this.jumpSkill = 0;
        }
      }

      ;

      if (key.keyCode == cc.macro.KEY.left) {
        this.value_left = 1;
      }

      ;

      if (key.keyCode == cc.macro.KEY.right) {
        this.value_right = 1;
      }

      ;
    }, this);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxwbGF5ZXIuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJqdW1wSGVpZ2h0IiwianVtcER1cmF0aW9uIiwicGFjZSIsImZydWl0TGFiZWwiLCJMYWJlbCIsImp1bXBTb3VuZCIsIkF1ZGlvQ2xpcCIsImp1bXBTa2lsbCIsImxpZmUiLCJsaWZlTGFiZWwiLCJvbkxvYWQiLCJkaXJlY3RvciIsImdldFBoeXNpY3NNYW5hZ2VyIiwiZW5hYmxlZCIsImdldENvbGxpc2lvbk1hbmFnZXIiLCJzeXN0ZW1FdmVudCIsIm9uIiwiU3lzdGVtRXZlbnQiLCJFdmVudFR5cGUiLCJLRVlfRE9XTiIsImtleSIsImtleUNvZGUiLCJtYWNybyIsIktFWSIsInVwIiwiR2xvYmFsIiwiZGlhbmppU291bmQiLCJhdWRpb0VuZ2luZSIsInBsYXkiLCJmaW5kIiwiZ2V0Q29tcG9uZW50Iiwic291bmQiLCJub2RlIiwicnVuQWN0aW9uIiwic2V0SnVtcEFjdGlvbiIsImxlZnQiLCJ2YWx1ZV9sZWZ0IiwicmlnaHQiLCJ2YWx1ZV9yaWdodCIsIktFWV9VUCIsIm9uQ29sbGlzaW9uRW50ZXIiLCJvdGhlciIsInNlbGYiLCJncm91cCIsImRlc3Ryb3kiLCJibGluayIsInN0cmluZyIsInN0YXJ0IiwidXBkYXRlIiwiZHQiLCJsZWZ0TW92ZSIsIkFuaW1hdGlvbiIsInN0b3AiLCJyaWdodE1vdmUiLCJyTW92ZSIsIm1vdmVCeSIsInYyIiwibE1vdmUiLCJqdW1wVXAiLCJlYXNpbmciLCJlYXNlQ3ViaWNBY3Rpb25PdXQiLCJvbkRlc3Ryb3kiLCJvZmYiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUVSO0FBQ0FD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QW1CbEUsRUFBRSxDQUFDcUIsV0FBSCxDQUFlQyxTQUFmLENBQXlCQyxRQUE1QyxFQUFzRCxVQUFVQyxHQUFWLEVBQWU7QUFDakUsVUFBSUEsR0FBRyxDQUFDQyxPQUFKLElBQWV6QixFQUFFLENBQUMwQixLQUFILENBQVNDLEdBQVQsQ0FBYUMsRUFBaEMsRUFBb0M7QUFDaEMsWUFBSSxLQUFLakIsU0FBTCxHQUFpQixDQUFyQixFQUF3QjtBQUNwQixjQUFJa0IsTUFBTSxDQUFDQyxXQUFYLEVBQXdCO0FBQ3BCOUIsWUFBQUEsRUFBRSxDQUFDK0IsV0FBSCxDQUFlQyxJQUFmLENBQW9CaEMsRUFBRSxDQUFDaUMsSUFBSCxDQUFRLDBCQUFSLEVBQW9DQyxZQUFwQyxDQUFpRCxXQUFqRCxFQUE4REMsS0FBbEYsRUFBeUYsS0FBekYsRUFBZ0csQ0FBaEc7QUFDSDs7QUFDRCxlQUFLQyxJQUFMLENBQVVDLFNBQVYsQ0FBb0IsS0FBS0MsYUFBTCxFQUFwQjtBQUNBLGVBQUszQixTQUFMLEdBQWlCLENBQWpCO0FBQ0g7QUFDSjs7QUFBQTs7QUFDRCxVQUFJYSxHQUFHLENBQUNDLE9BQUosSUFBZXpCLEVBQUUsQ0FBQzBCLEtBQUgsQ0FBU0MsR0FBVCxDQUFhWSxJQUFoQyxFQUFzQztBQUNsQyxhQUFLQyxVQUFMLEdBQWtCLENBQWxCO0FBQ0g7O0FBQUE7O0FBQ0QsVUFBSWhCLEdBQUcsQ0FBQ0MsT0FBSixJQUFlekIsRUFBRSxDQUFDMEIsS0FBSCxDQUFTQyxHQUFULENBQWFjLEtBQWhDLEVBQXVDO0FBQ25DLGFBQUtDLFdBQUwsR0FBbUIsQ0FBbkI7QUFDSDs7QUFBQTtBQUNKLEtBaEJELEVBZ0JHLElBaEJIO0FBaUJIO0FBaklJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExlYXJuIGNjLkNsYXNzOlxyXG4vLyAgLSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9jbGFzcy5odG1sXHJcbi8vIExlYXJuIEF0dHJpYnV0ZTpcclxuLy8gIC0gaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvcmVmZXJlbmNlL2F0dHJpYnV0ZXMuaHRtbFxyXG4vLyBMZWFybiBsaWZlLWN5Y2xlIGNhbGxiYWNrczpcclxuLy8gIC0gaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvbGlmZS1jeWNsZS1jYWxsYmFja3MuaHRtbFxyXG5cclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuXHJcbiAgICAgICAgLy8g5Li76KeS6Lez6LeD6auY5bqmXHJcbiAgICAgICAganVtcEhlaWdodDogMjAwLFxyXG4gICAgICAgIC8vIOS4u+inkui3s+i3g+aMgee7reaXtumXtFxyXG4gICAgICAgIGp1bXBEdXJhdGlvbjogMC4zLFxyXG4gICAgICAgIHBhY2U6IDEwLFxyXG4gICAgICAgIGZydWl0TGFiZWw6IGNjLkxhYmVsLFxyXG4gICAgICAgIGp1bXBTb3VuZDogY2MuQXVkaW9DbGlwLFxyXG4gICAgICAgIGp1bXBTa2lsbDogMSxcclxuICAgICAgICBsaWZlOiAzLFxyXG4gICAgICAgIGxpZmVMYWJlbDogY2MuTGFiZWwsXHJcbiAgICB9LFxyXG5cclxuICAgIC8vIExJRkUtQ1lDTEUgQ0FMTEJBQ0tTOlxyXG5cclxuICAgIG9uTG9hZCgpIHtcclxuICAgICAgICBjYy5kaXJlY3Rvci5nZXRQaHlzaWNzTWFuYWdlcigpLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgIGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAvL+aMieWOi+WKn+iDvVxyXG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9uKGNjLlN5c3RlbUV2ZW50LkV2ZW50VHlwZS5LRVlfRE9XTiwgZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgICAgICBpZiAoa2V5LmtleUNvZGUgPT0gY2MubWFjcm8uS0VZLnVwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5qdW1wU2tpbGwgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEdsb2JhbC5kaWFuamlTb3VuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5wbGF5KGNjLmZpbmQoXCJDYW52YXMvTWFpbiBDYW1lcmEvcGF1c2VcIikuZ2V0Q29tcG9uZW50KFwiZ2FtZV9tZW51XCIpLnNvdW5kLCBmYWxzZSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS5ydW5BY3Rpb24odGhpcy5zZXRKdW1wQWN0aW9uKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuanVtcFNraWxsID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaWYgKGtleS5rZXlDb2RlID09IGNjLm1hY3JvLktFWS5sZWZ0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlX2xlZnQgPSAxO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAoa2V5LmtleUNvZGUgPT0gY2MubWFjcm8uS0VZLnJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlX3JpZ2h0ID0gMTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICAvL+aKrOi1t+WKn+iDvVxyXG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9uKGNjLlN5c3RlbUV2ZW50LkV2ZW50VHlwZS5LRVlfVVAsIGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgaWYgKGtleS5rZXlDb2RlID09IGNjLm1hY3JvLktFWS5sZWZ0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlX2xlZnQgPSAwO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAoa2V5LmtleUNvZGUgPT0gY2MubWFjcm8uS0VZLnJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlX3JpZ2h0ID0gMDtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9LCB0aGlzKTtcclxuXHJcbiAgICB9LFxyXG5cclxuICAgIG9uQ29sbGlzaW9uRW50ZXI6IGZ1bmN0aW9uIChvdGhlciwgc2VsZikge1xyXG4gICAgICAgIGlmIChvdGhlci5ub2RlLmdyb3VwID09IFwiamVsbHlmaXNoXCIpIHtcclxuICAgICAgICAgICAgb3RoZXIubm9kZS5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIHRoaXMubGlmZS0tO1xyXG4gICAgICAgICAgICBzZWxmLm5vZGUucnVuQWN0aW9uKG5ldyBjYy5ibGluaygwLjUsIDMpKTtcclxuICAgICAgICAgICAgLy9jYy5maW5kKFwiQ2FudmFzL01haW4gQ2FtZXJhXCIpLmdldENvbXBvbmVudChcImdhbWVfMVwiKS50aW1lciA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMubGlmZUxhYmVsLnN0cmluZyA9IFwiWCBcIiArIHRoaXMubGlmZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChvdGhlci5ub2RlLmdyb3VwID09IFwiaGVhcnRcIikge1xyXG4gICAgICAgICAgICB0aGlzLmxpZmUrKztcclxuICAgICAgICAgICAgdGhpcy5saWZlTGFiZWwuc3RyaW5nID0gXCJYIFwiICsgdGhpcy5saWZlO1xyXG4gICAgICAgICAgICBvdGhlci5ub2RlLmRlc3Ryb3koKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChvdGhlci5ub2RlLmdyb3VwID09IFwiaG9tZVwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuanVtcFNraWxsID0gMTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuXHJcbiAgICBzdGFydCgpIHtcclxuXHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZShkdCkge1xyXG4gICAgICAgIGlmICh0aGlzLnZhbHVlX2xlZnQgPT0gMSkge1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUucnVuQWN0aW9uKHRoaXMubGVmdE1vdmUoKSk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbikucGxheShcIua0vuWkp+aYn+W3pui1sFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29tcG9uZW50KGNjLkFuaW1hdGlvbikuc3RvcChcIua0vuWkp+aYn+W3pui1sFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMudmFsdWVfcmlnaHQgPT0gMSkge1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUucnVuQWN0aW9uKHRoaXMucmlnaHRNb3ZlKCkpO1xyXG4gICAgICAgICAgICB0aGlzLmdldENvbXBvbmVudChjYy5BbmltYXRpb24pLnBsYXkoXCLmtL7lpKfmmJ/lj7PotbBcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmdldENvbXBvbmVudChjYy5BbmltYXRpb24pLnN0b3AoXCLmtL7lpKfmmJ/lj7PotbBcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcblxyXG4gICAgcmlnaHRNb3ZlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbGV0IHJNb3ZlID0gY2MubW92ZUJ5KDAuMDIsIGNjLnYyKHRoaXMucGFjZSwgMCkpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5vZGUucnVuQWN0aW9uKHJNb3ZlKTtcclxuICAgIH0sXHJcbiAgICBsZWZ0TW92ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxldCBsTW92ZSA9IGNjLm1vdmVCeSgwLjAyLCBjYy52MigtdGhpcy5wYWNlLCAwKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5ydW5BY3Rpb24obE1vdmUpO1xyXG4gICAgfSxcclxuICAgIHNldEp1bXBBY3Rpb246IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvLyDot7Pot4PkuIrljYdcclxuICAgICAgICBsZXQganVtcFVwID0gY2MubW92ZUJ5KHRoaXMuanVtcER1cmF0aW9uLCBjYy52MigwLCB0aGlzLmp1bXBIZWlnaHQpKS5lYXNpbmcoY2MuZWFzZUN1YmljQWN0aW9uT3V0KCkpO1xyXG4gICAgICAgIC8vIOS4i+iQvVxyXG4gICAgICAgIC8vIGxldCBqdW1wRG93biA9IGNjLm1vdmVCeSh0aGlzLmp1bXBEdXJhdGlvbiwgY2MudjIoMCwgLXRoaXMuanVtcEhlaWdodCkpLmVhc2luZyhjYy5lYXNlQ3ViaWNBY3Rpb25JbigpKTtcclxuICAgICAgICAvLyAvLyDljZXmrKHkuIrljYfkuIvokL1cclxuICAgICAgICAvLyByZXR1cm4gY2Muc2VxdWVuY2UoanVtcFVwLCBqdW1wRG93bik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5ydW5BY3Rpb24oanVtcFVwKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25EZXN0cm95KCkge1xyXG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9mZihjYy5TeXN0ZW1FdmVudC5FdmVudFR5cGUuS0VZX0RPV04sIGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgaWYgKGtleS5rZXlDb2RlID09IGNjLm1hY3JvLktFWS51cCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuanVtcFNraWxsID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChHbG9iYWwuZGlhbmppU291bmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUucGxheShjYy5maW5kKFwiQ2FudmFzL01haW4gQ2FtZXJhL3BhdXNlXCIpLmdldENvbXBvbmVudChcImdhbWVfbWVudVwiKS5zb3VuZCwgZmFsc2UsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGUucnVuQWN0aW9uKHRoaXMuc2V0SnVtcEFjdGlvbigpKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmp1bXBTa2lsbCA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGlmIChrZXkua2V5Q29kZSA9PSBjYy5tYWNyby5LRVkubGVmdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZV9sZWZ0ID0gMTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaWYgKGtleS5rZXlDb2RlID09IGNjLm1hY3JvLktFWS5yaWdodCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZV9yaWdodCA9IDE7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSwgdGhpcyk7XHJcbiAgICB9LFxyXG59KTtcclxuIl19